#!/usr/bin/env sh

dir=$(CDPATH= cd -- "$(dirname -- "$0")" && pwd)

excludefiles=". .. .DS_Store .git .gitignore .gitmodules .config .local"
exclude() {
  test "${excludefiles#*$1}" != "$excludefiles"
  return $?
}

mkdir -p "$HOME/.config" \
         "$HOME/.local/bin"

for file in .* .local/bin/* .config/*
do
  exclude "$file" && continue

  echo "Linking $file"
 
  # Backup existing files
  if [ -e "$HOME/$file" ] && [ ! -L "$HOME/$file" ]; then
    backup="$file.backup.$(date +%s)"
    mv "$HOME/$file" "$HOME/$backup"
  fi

  # Create symlink
  ln -nfs "$dir/$file" "$HOME/$file"
done
